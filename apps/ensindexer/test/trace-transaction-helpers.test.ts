import { getAddressesFromTrace } from "@/lib/trace-transaction-helpers";
import { describe, expect, it } from "vitest";
import {
  getExampleTransactionTrace,
  getExampleTransactionTraceSerializedAddress,
} from "./utils/example-trace-transactions";

describe("transaction helpers", () => {
  describe("getAddressesFromTrace", () => {
    it("should extract all addresses from a transaction trace", () => {
      const trace = getExampleTransactionTrace();
      const addresses = getAddressesFromTrace(trace);

      expect(addresses).toEqual(
        new Set([
          "0xeDEE915Ae45Cc4B2FDd1Ce12a2f70dCa0B2AD9e5",
          "0xe915058dF18e7Efe92aF5c44Df3F575FBA061B64",
          "0x9fAD9FFceA95c345D41055a63bD099E1a0576109",
          "0x0000000000000000000000000000000000000001",
          "0x3DB8BC8c9BD565877B363AB4b4E7F39A777d5500",
          "0xE5857440BBFF64C98CEb70d650805E1E96addE7A",
          "0xb39e09279D4035c0F92307741d9dd8ed66e74de0",
          "0xC8aF9C2389AF5710Dba268050EbF9350CD0ACab3",
          "0xb684849F3a7bd53FbAD882302b5f7b9276C9B491",
          "0x5693e9eF54F7B78DdEf14997C1fbC51AA1d2FAc9",
          "0x60eEB5870ebEf49ce7cDc354dac49906CF8d9285",
          "0x2F84F6F613280Fd4dF11Ab2480E777ba8BB6282A",
          "0xF61f3C9cEcB8d206DeA1faEd99A693e6d3BAAEf2",
          "0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",
          "0x314159265dD8dbb310642f98f50C066173C1259b",
          "0xF58D55F06bB92f083E78bb5063A2DD3544f9B6a3",
          "0x084b1c3C81545d370f3634392De611CaaBFf8148",
          "0x15F50bB48cA4BE1aD4A6Ad5804B18FB7D198618F",
          "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
          "0xa2327a938Febf5FEC13baCFb16Ae10EcBc4cbDCF",
          "0x0000000000000000000000000000000000000000",
          "0x00000000000000000000000000000000000000Be",
          "0x00000000000000000000000000000000000F4240",
          "0x0000000000000000000000000000000000000120",
          "0x0000000000000000000000000000000000000420",
          "0x00000000000000000000000000000000000002c4",
          "0x497BB46fBac4658BE6fE113927aF536c68552282",
          "0x0000000000000000000000000000000000000003",
          "0x00000000000000000000000000000000000000E0",
          "0x00000000000000000000000000000000000001a0",
          "0x0000000000000000000000000000000000000240",
          "0x000000000000000000000000000000000000000A",
          "0x00000000000000000041C612de330711Ec108F2f",
          "0x0000000000000000000000000000000000000400",
          "0x0000000000000000000000000000000000000042",
          "0x000000000000000000000000004237f1058471f5",
          "0x0000000000000000000000000000000000003dB8",
          "0x000000000000000000000000000000000000001c",
          "0x0000000000000000000000000000000000000040",
          "0x0000000000000000000000000000000000000004",
          "0x03DB8bc8c9bd565877b363Ab4b4e7f39A777d550",
          "0x6325d247696D39ee59Ffd931a87e022A68bbBE4f",
          "0x00000000000000000000000000000000617Fe48d",
          "0x0000000000000000000000000000000000000080",
          "0x00000000000000000000000000000000000000C0",
          "0x000000000000000000000000000000000000001B",
          "0xD15953bD7cbCb36B69d4b9961b56F59cC2553d2E",
          "0x0000000000000000000000000000000000000017",
          "0x0000000000000000000000000000000000000044",
          "0x0000000000000000000000000000000000000020",
          "0x00000000000000000000000000000000000aac2b",
          "0x4eaD68830F45D73478C93953ED56c532bffff4B5",
          "0xeE94cf48924B720AF939E732E98F30F9594f87C5",
          "0x0000000000000000000000000000000007EBc7EA",
        ]),
      );
      expect(addresses.size).toBe(54);
    });

    it("should extract all addresses, including serialized ones, from a transaction trace", () => {
      const trace = getExampleTransactionTraceSerializedAddress();
      const addresses = getAddressesFromTrace(trace);

      expect(addresses).toEqual(
        new Set([
          "0x5cA1e1Ab50E1c9765F02B01FD2Ed340f394c5DDA",
          "0xa58E81fe9b61B5c3fE2AFD33CF304c454AbFc7Cb",
          "0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",
          "0x231b0Ee14048e9dCcD1d247744d114a4EB5E8E63",
          "0x5fe156F51443AE995300efC719DDeAE1D2C76730",
          "0x0000000000000000000000000000000000000080",
          "0x000000000000000000000000000000000000000F",
          "0x0000000000000000000000000000000000000001",
          "0x0000000000000000000000000000000000000000",
          "0x0000000000000000000000000000000000000040",
        ]),
      );
      expect(addresses.size).toBe(10);
    });
  });
});
