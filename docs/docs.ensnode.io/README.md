# ENSNode Documentation

[docs.ensnode.io](https://docs.ensnode.io) runs on [Mintlify](https://mintlify.com).

Learn more about [ENSNode](https://ensnode.io) from [the "Starlight" ENSNode docs](https://ensnode.io/docs/). Everything from these "Starlight" docs is planned to be transitioned into these Mintlify docs soon.

## Local Development

1. `git clone https://github.com/namehash/ensnode.git`
2. `cd docs/docs.ensnode.io`
3. `pnpm mint dev`
4. Open [http://localhost:3000](http://localhost:3000) in your browser

### Troubleshooting

- If a page loads as a 404, ensure you're running in a folder with a valid `docs.json`
- Run `pnpm mint --help` for more Mintlify CLI details

## Deployments

Mintlify deploys automatically: preview deploys on each branch, production deploys on merge to `main`.

| Content Type      | Source             | Behavior                                    |
| ----------------- | ------------------ | ------------------------------------------- |
| **API Reference** | Production API URL | Always in sync with deployed production API |
| **Other docs**    | Committed files    | Deploys immediately on merge to main        |

Non-API documentation (guides, concepts, etc.) may be published before the corresponding code is released to production. The API Reference always reflects the actual production API since Mintlify fetches it from the production URL at build time.

For the case of a feature that's not ready to publicly announce in our docs as soon as it is merged to main:

1. **Keep documentation PRs separate from code PRs**
2. **Merge documentation PRs only after the corresponding code is deployed to production**

## API Reference

The API Reference is generated from an OpenAPI spec. Two sources are used depending on context:

| Context         | OpenAPI Source                              | Page                                                            |
| --------------- | ------------------------------------------- | --------------------------------------------------------------- |
| **Production**  | Fetched from `https://api.alpha.ensnode.io` | API Reference                                                   |
| **PR Previews** | Committed `openapi.json` file               | [Preview page](https://docs.ensnode.io/ensapi/preview) (hidden) |

This means production docs always reflect the live API, while PR previews can show upcoming API changes before they're deployed.

### Generating the Spec

When you modify API routes or schemas in ENSApi, regenerate the OpenAPI spec:

```bash
# Start ENSApi in OpenAPI generate mode (no external dependencies required)
OPENAPI_GENERATE_MODE=true pnpm --filter ensapi start

# In another terminal, generate the spec
pnpm --filter @docs/mintlify openapi:generate http://localhost:4334
```

**`OPENAPI_GENERATE_MODE`:** ENSApi normally requires a running ENSIndexer and ENSDb to start. This mode uses a mock configuration that allows ENSApi to start without external dependencies, allowing OpenAPI spec generation in local dev and CI environments.

The ENSApi URL argument to `openapi:generate` is required â€” there is no default to avoid accidentally generating from the wrong source.

### CI Validation

On every PR the CI runs an `openapi-sync-check` job that:

1. Starts ENSApi (based on the code in the branch associated with the PR) with `OPENAPI_GENERATE_MODE=true`
2. Fetches an autogenerated OpenAPI spec from the running ENSApi server
3. Compares the fetched autogenerated OpenAPI spec against the committed [`openapi.json`](./openapi.json), failing with a diff if they don't match
4. Validates that Mintlify can parse the spec with `mintlify openapi-check`

### Environment Switch

When NameHash Labs switches their hosted ENSNode production environments (ex: from green -> blue) using the `deploy_switch_ensnode_environment` workflow, it triggers Mintlify to rebuild the "production" OpenAPI docs by fetching the latest OpenAPI spec returned from the ENSNode environment that is now serving production API requests.

## Resources

- [Mintlify documentation](https://mintlify.com/docs)
- [ENSNode "Starlight" docs](https://ensnode.io/docs/)
